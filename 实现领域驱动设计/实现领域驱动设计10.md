# 第10章 聚合

> 本章学习路线图
>
> - 以SaaSOvation为例，学习对聚合的不当建模所带来的负面影响
> - 学习设计聚合的经验原则，并形成一套最佳实践
> - 根据真实的业务规则，掌握如何在一致性边界中对真正的不变条件进行建模
> - 学习一个聚合为什么应该通过标识（identity）去引用另一个聚合
> - 了解在聚合边界之外使用最终一致性的重要性
> - 学习聚合的实现技术，包括“告诉而非询问”原则和迪米特法则

将实体（5）和值对象（6）在一致性边界之内组成聚合。有很多途径都将导致我们建立不正确的聚合模型，我们应该将注意力集中在业务规则上来避免各种不良情况。



## 在Scrum核心领域中使用聚合

本章书中以SaaSOvation团队的ProjectOvation项目的敏捷项目管理上下文为例，通过Scrum项目建立模型的过程来给出了使用聚合的分析思路。

> 聚合模型讨论的是对象组合和信息隐藏，此外还包含了一致性边界和事务。



## 原则：在一致性边界之内建模真正的不变条件

要从限界上下文中发现聚合，我们需要了解模型中真正的不变条件。只有这样，我们才能决定什么样的对象可以放在一个聚合中。这里的不变条件表示一个业务规则，该规则应该总是保持一致性的。聚合边界之内的所有内容组成了一套不变的业务规则，任何操作都不能违背这些规则。边界之外的任何东西与该聚合都是不相关的。

在讨论不变条件时，我们讨论的是事务一致性。在设计聚合时，我们主要关注的是聚合的一致性边界，而不是创建一个对象树。

> 在一个事务中只能修改一个聚合实例。



## 原则：设计小聚合

对于大聚合，即便我们可以保证事务的成功执行，它依然有可能限制系统的性能和可伸缩性。系统性能和可伸缩性虽然是非功能性需求，但是我们绝不应该予以忽视。

> 属于DFX特性，具体详见《[何所谓DFX-云社区-华为云](https://bbs.huaweicloud.com/blogs/111852)》





















