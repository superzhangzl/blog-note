# 第7章 领域事件

> 本章学习路线图
>
> - 学习什么是领域事件，什么时候并且为什么要使用领域事件
> - 学习如何将领域事件建模成对象，何时应该为领域事件创建唯一的身份标识
> - 学习一个轻量级的**发布-订阅**模式
> - 学习哪些组件用于发布事件，哪些组件用于订阅事件
> - 学习为什么我们需要一个事件存储、如何实现事件存储、如何使用使用事件存储
> - 学习SooSOvation团队是如何通过不同的方式将领域事件发布给自治系统的、

使用**领域事件（Domain Event）**来捕获发生在领域中的一些事情。



## 何时/为什么使用领域事件

当前对领域事件的定义：

- 领域专家所关心的发生在领域中的一些事情。
- 将领域中所发生的活动建模成一些列的离散事件。每个事件都用领域对象来表示，领域事件是领域模型的组成部分，表示领域中所发生的事情。



考虑以下领域专家的关键词汇来确定哪些事件比较重要：

- 当……
- 如果发生……
- 当……的时候
- 发生……时

根据组织文化，通过此类事件用于来确定更多的事件。

有时在跨团队沟通时会发现先前领域专家未意识到的一些需求，一般这种情况是由于领域事件需要发布到外部系统中，比如发布到另一个限界上下文中。

> 当团队成员对领域事件达成一致之后，领域事件便是**通用语言**的正式组成部分了。



当领域事件达到目的地后——无论是本地系统还是外部系统——我们通常将领域事件用于维护事件的一致性。这样可以消除两阶段提交（全局事务），还可以支持**聚合（10）**。

> 聚合的其中一个原则是：在单个事务中，只允许对一个聚合实例进行修改，由此产生的其他改变必须在单独的事务中完成。

如图所示展示了领域事件的产生、存储、分发和使用。领域事件即可以由本地限界上下文所消费，也可以由外部限界上下文消费。

TODO

对于系统中发生的每一件事情，我们都可以用事件的形式予以捕获，然后将事件发布给订阅方处理，这样能达到简化系统的目的。原来批量集中处理的过程可以分散成许多粒度较小的单元。