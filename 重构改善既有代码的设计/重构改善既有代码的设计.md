# ã€Šé‡æ„ æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹

> é‡æ„æ–¹æ³•é€ŸæŸ¥è¡¨ï¼Œé€šè¿‡ç¤ºä¾‹æ¥å¿«é€Ÿå›å¿†å‡ºå¯¹åº”é‡æ„æ–¹æ³•çš„å†…å®¹ï¼Œå¹¶ç»™å‡ºä¸­æ–‡ç¬¬2ç‰ˆä¹¦ä¸­å¯¹åº”çš„é¡µç ã€‚ğŸ˜œ
>
> æ ¼å¼ï¼šç« èŠ‚å· é‡æ„æ–¹æ³•åç§°ï¼ˆ é‡æ„æ–¹æ³•è‹±æ–‡åç§°ï¼‰[é¡µç ]



## ç¬¬6ç«  ç¬¬ä¸€ç»„é‡æ„

### 6.1 æç‚¼å‡½æ•°ï¼ˆExtract Functionï¼‰[106]

```javascript
function printOwing(invoice) {
    printBanner();
    let outstanding = calculateOutstanding();
    
    //print details
    console.log(`name: ${invoice.customer}`);
    console.log(`amount: ${outstanding}`);
}
```

ğŸ‘‡

```javascript
function printOwing(invoice) {
    printBanner();
    let outstanding = calculateOutstanding();
    
    function printDetails(outstanding) {
        console.log(`name: ${invoice.customer}`);
        console.log(`amount: ${outstanding}`);
    }
}
```



### 6.2 å†…è”å‡½æ•°ï¼ˆInline Functionï¼‰[115]

```javascript
function getRating(driver) {
    return moreThanFiveLateDeliveries(driver) ? 2 : 1;
}

function moreThanFiveLateDeliveries(driver) {
    return driver.numberOfLateDeliveries > 5;
}
```

ğŸ‘‡

```javascript
function getRating(driver) {
    return (driver.numberOfLateDeliveries > 5) ? 2 : 1;
}
```



### 6.3 æç‚¼å˜é‡ï¼ˆExtract Variableï¼‰[119]

```javascript
return order.quantity * order.itemPrice -
    Math.max(0, order.quantity - 500) * order.itemPrice * 0.05 +
    Math.min(order.quantity * order.itemPrice * 0.01, 100);
```

ğŸ‘‡

```javascript
const basePrice = order.quantity * order.itemPrice;
const quantityDiscount = Math.max(0, order.quantity - 500) * order.itemPrice * 0.05;
const shipping = Math.min(order.quantity * order.itemPrice * 0.01, 100);
return basePrice - quantityDiscount + shipping;
```



### 6.4 å†…è”å˜é‡ï¼ˆInline Variableï¼‰[123]

```javascript
let basePrice = anOrder.basePrice;
return (basePrice > 1000);
```

ğŸ‘‡

```javascript
return anOrder.basePrice > 1000;
```



### 6.5 æ”¹å˜å‡½æ•°ç­¾åï¼ˆChange Function Declarationï¼‰[124]

> æŠŠâ€œå£°æ˜â€æ”¹ä¸ºäº†â€œç­¾åâ€

```javascript
function circum(radius) {... }
```

ğŸ‘‡

```javascript
function circumference(radius) {... }
```



### 6.6 å°è£…å˜é‡ï¼ˆEncapsulate Variableï¼‰[132]

```javascript
let defaultOwner = { firstName: "Martin", lastName: "Fowler" };
```

ğŸ‘‡

```javascript
let defaultOwnerData = { firstName: "Martin", lastName: "Fowler" };
export function defaultOwner() { return defaultOwnerData; }
export function setDefaultOwner(arg) { defaultOwnerData = arg; }
```



### 6.7 æç‚¼å‡½æ•°ï¼ˆRename Variableï¼‰[137]

```javascript
let a = height * width;
```

ğŸ‘‡

```javascript
let area = height * width;
```



### 6.8 å¼•å…¥å‚æ•°å¯¹è±¡ï¼ˆIntroduce Parameter Objectï¼‰[140]

```javascript
function amountInvoiced(startDate, endDate) {... }
function amountReceived(startDate, endDate) {... }
function amountOverdue(startDate, endDate) {... }
```

ğŸ‘‡

```javascript
function amountInvoiced(aDateRange ) {... }
function amountReceived(aDateRange ) {... }
function amountOverdue(aDateRange ) {... }
```



### 6.9 å‡½æ•°ç»„åˆæˆç±»ï¼ˆCombine Functions into Classï¼‰[144]

```javascript
function base(aReading) {... }
function taxableCharge(aReading) {... }
function calculateBaseCharge(aReading) {... }
```

ğŸ‘‡

```javascript
class Reading {
    base(aReading) {... }
    taxableCharge(aReading) {... }
    calculateBaseCharge(aReading) {... }
}
```



### 6.10 å‡½æ•°ç»„åˆæˆå˜æ¢ï¼ˆCombine Functions into Transformï¼‰[149]

```javascript
function base(aReading) {... }
function taxableCharge(aReading) {... }
```

ğŸ‘‡

```javascript
function enrichReading(argReading) {
    const aReading = _.cloneDeep(argReading);
    aReading.baseCharge = base(aReading);
    aReading.taxableCharge = taxableCharge(aReading);
    return aReading;
}
```



### 6.11 æ‹†åˆ†é˜¶æ®µï¼ˆSplit Phaseï¼‰[154]

```javascript
const orderData = orderString.split(/\s+/);
const productPrice = priceList[orderData[0].split("-")[1]];
const orderPrice = parseInt(orderData[1]) * productPrice;
```

ğŸ‘‡

```javascript
const orderRecord = parseOrder(order);
const orderPrice = price(orderRecord, priceList);

function parseOrder(aString) {
    const values = aString.split(/\s+/);
    return ({
        productID: values[0].split("-")[1],
        quantity: parseInt(values[1]),
    });
}
function price(order, priceList) {
    return order.quantity * priceList[order.productID];
}
```





## ç¬¬7ç«  å°è£…

### 7.1 å°è£…è®°å½•ï¼ˆEncapsulate Recordï¼‰[162]

```javascript
organization = {name: "Acme Gooseberries", country: "GB"};
```

ğŸ‘‡

```javascript
class Organization {
    constructor(data) {
        this._name = data.name;
        this._country = data.country;
    }
    get name() {return this._name;}
    set name(arg) {this._name = arg;}
    get country() {return this._name;}
    set country(arg) {this._country = arg;}
}
```



### 7.2 å°è£…é›†åˆï¼ˆEncapsulate Collectionï¼‰[170]

```javascript
class Person {
    get courses() {this._courses;}
    set courses() {this._courses;}
}
```

ğŸ‘‡

```javascript
class Person {
    get courses() {this._courses.slice();}
    addCourse(aCourse) {...}
    removeCourse(aCourse) {...}
}
```



### 7.3 ä»¥å¯¹è±¡å–ä»£åŸºæœ¬ç±»å‹ï¼ˆReplace Primitive with Objectï¼‰[174]

```javascript
orders.filter(o => "high" === o.priority
             || "rush" === o.priority);
```

ğŸ‘‡

```javascript
orders.filter(o => o.priority.higherThan(new Priority("normal")))
```



### 7.4 ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡ï¼ˆReplace Temp with Queryï¼‰[178]

```javascript
const basePrice = this._quantity * this._itemPrice;
if (basePrice > 1000)
    return basePrice * 0.95;
else 
    return basePrice * 0.98;
```

ğŸ‘‡

```javascript
get basePrice() { this._quantity * this._itemPrice;}
...
if (this.basePrice > 1000)
    return this.basePrice * 0.95;
else
    return this.basePrice * 0.98;
```



## 7.5 æç‚¼ç±»ï¼ˆExtract Classï¼‰[182]

```javascript
class Person {
    get officeAreaCode() {return this._officeAreaCode;}
    get officeNumber() {return this._officeNumber;}
}
```

ğŸ‘‡

```javascript
class Person {
    get officeAreaCode() {
        return this._telephoneNumber.areaCode;
    }
    get officeNumber() {
        return this._telephoneNumber.number;
    }
}
class TelephoneNumber {
    get areaCode() {return this._areaCode;}
    get number() {return this._number;}
}
```



## 7.6 å†…è”ç±»ï¼ˆInline Classï¼‰[186]

```javascript
class Person {
    get officeAreaCode() {
        return this._telephoneNumber.areaCode;
    }
    get officeNumber() {
        return this._telephoneNumber.number;
    }
}
class TelephoneNumber {
    get areaCode() {return this._areaCode;}
    get number() {return this._number;}
}
```

ğŸ‘‡

```javascript
class Person {
    get officeAreaCode() {return this._officeAreaCode;}
    get officeNumber() {return this._officeNumber;}
}
```



## 7.7 éšè—å§”æ‰˜å…³ç³»ï¼ˆHide Delegateï¼‰[189]

```javascript
member = aPerson.department.manager;
```

ğŸ‘‡

```javascript
manager = aPerson.manager;
class Person {
    get manager() {this._department.manager;}
}
```



## 7.8 ç§»å‡ºä¸­é—´äººï¼ˆRemove Middle Manï¼‰[192]

```javascript

manager = aPerson.manager;
class Person {
    get manager() {this._department.manager;}
}
```

ğŸ‘‡

```javascript
member = aPerson.department.manager;
```



## 7.9 æ›¿æ¢ç®—æ³•ï¼ˆSubstitute Algorithmï¼‰[195]

```javascript
function foundPerson(people) {
    for (let i = 0; i < people.length; i++) {
        if (people[i] === "Don") {
            return "Don";
        }
        if (people[i] === "John") {
            return "John";
        }
        if (people[i] === "Kent") {
            return "Kent";
        }
    }
    return "";
}
```

ğŸ‘‡

```javascript
function foundPerson(people) {
    const candidates = [];
    return people.find(p => candidates.includes(p)) || '';
}
```

