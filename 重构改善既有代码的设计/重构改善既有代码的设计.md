# 《重构 改善既有代码的设计》

> 重构方法速查表，通过示例来快速回忆出对应重构方法的内容，并给出中文第2版书中对应的页码。😜
>
> 格式：章节号 重构方法名称（ 重构方法英文名称）[页码]



## 第6章 第一组重构

### 6.1 提炼函数（Extract Function）[106]

```javascript
function printOwing(invoice) {
    printBanner();
    let outstanding = calculateOutstanding();
    
    //print details
    console.log(`name: ${invoice.customer}`);
    console.log(`amount: ${outstanding}`);
}
```

👇

```javascript
function printOwing(invoice) {
    printBanner();
    let outstanding = calculateOutstanding();
    
    function printDetails(outstanding) {
        console.log(`name: ${invoice.customer}`);
        console.log(`amount: ${outstanding}`);
    }
}
```



### 6.2 内联函数（Inline Function）[115]

```javascript
function getRating(driver) {
    return moreThanFiveLateDeliveries(driver) ? 2 : 1;
}

function moreThanFiveLateDeliveries(driver) {
    return driver.numberOfLateDeliveries > 5;
}
```

👇

```javascript
function getRating(driver) {
    return (driver.numberOfLateDeliveries > 5) ? 2 : 1;
}
```



### 6.3 提炼变量（Extract Variable）[119]

```javascript
return order.quantity * order.itemPrice -
    Math.max(0, order.quantity - 500) * order.itemPrice * 0.05 +
    Math.min(order.quantity * order.itemPrice * 0.01, 100);
```

👇

```javascript
const basePrice = order.quantity * order.itemPrice;
const quantityDiscount = Math.max(0, order.quantity - 500) * order.itemPrice * 0.05;
const shipping = Math.min(order.quantity * order.itemPrice * 0.01, 100);
return basePrice - quantityDiscount + shipping;
```



### 6.4 内联变量（Inline Variable）[123]

```javascript
let basePrice = anOrder.basePrice;
return (basePrice > 1000);
```

👇

```javascript
return anOrder.basePrice > 1000;
```



### 6.5 改变函数签名（Change Function Declaration）[124]

> 把“声明”改为了“签名”

```javascript
function circum(radius) {... }
```

👇

```javascript
function circumference(radius) {... }
```



### 6.6 封装变量（Encapsulate Variable）[132]

```javascript
let defaultOwner = { firstName: "Martin", lastName: "Fowler" };
```

👇

```javascript
let defaultOwnerData = { firstName: "Martin", lastName: "Fowler" };
export function defaultOwner() { return defaultOwnerData; }
export function setDefaultOwner(arg) { defaultOwnerData = arg; }
```



### 6.7 提炼函数（Rename Variable）[137]

```javascript
let a = height * width;
```

👇

```javascript
let area = height * width;
```



### 6.8 引入参数对象（Introduce Parameter Object）[140]

```javascript
function amountInvoiced(startDate, endDate) {... }
function amountReceived(startDate, endDate) {... }
function amountOverdue(startDate, endDate) {... }
```

👇

```javascript
function amountInvoiced(aDateRange ) {... }
function amountReceived(aDateRange ) {... }
function amountOverdue(aDateRange ) {... }
```



### 6.9 函数组合成类（Combine Functions into Class）[144]

```javascript
function base(aReading) {... }
function taxableCharge(aReading) {... }
function calculateBaseCharge(aReading) {... }
```

👇

```javascript
class Reading {
    base(aReading) {... }
    taxableCharge(aReading) {... }
    calculateBaseCharge(aReading) {... }
}
```



### 6.10 函数组合成变换（Combine Functions into Transform）[149]

```javascript
function base(aReading) {... }
function taxableCharge(aReading) {... }
```

👇

```javascript
function enrichReading(argReading) {
    const aReading = _.cloneDeep(argReading);
    aReading.baseCharge = base(aReading);
    aReading.taxableCharge = taxableCharge(aReading);
    return aReading;
}
```



### 6.11 拆分阶段（Split Phase）[154]

```javascript
const orderData = orderString.split(/\s+/);
const productPrice = priceList[orderData[0].split("-")[1]];
const orderPrice = parseInt(orderData[1]) * productPrice;
```

👇

```javascript
const orderRecord = parseOrder(order);
const orderPrice = price(orderRecord, priceList);

function parseOrder(aString) {
    const values = aString.split(/\s+/);
    return ({
        productID: values[0].split("-")[1],
        quantity: parseInt(values[1]),
    });
}
function price(order, priceList) {
    return order.quantity * priceList[order.productID];
}
```





