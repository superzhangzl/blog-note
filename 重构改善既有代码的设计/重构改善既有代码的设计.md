# ã€Šé‡æ„ æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹

> é‡æ„æ–¹æ³•é€ŸæŸ¥è¡¨ï¼Œé€šè¿‡ç¤ºä¾‹æ¥å¿«é€Ÿå›å¿†å‡ºå¯¹åº”é‡æ„æ–¹æ³•çš„å†…å®¹ï¼Œå¹¶ç»™å‡ºä¸­æ–‡ç¬¬2ç‰ˆä¹¦ä¸­å¯¹åº”çš„é¡µç ã€‚ğŸ˜œ
>
> æ ¼å¼ï¼šç« èŠ‚å· é‡æ„æ–¹æ³•åç§°ï¼ˆ é‡æ„æ–¹æ³•è‹±æ–‡åç§°ï¼‰[é¡µç ]



## ç¬¬6ç«  ç¬¬ä¸€ç»„é‡æ„

### 6.1 æç‚¼å‡½æ•°ï¼ˆExtract Functionï¼‰[106]

```javascript
function printOwing(invoice) {
    printBanner();
    let outstanding = calculateOutstanding();
    
    //print details
    console.log(`name: ${invoice.customer}`);
    console.log(`amount: ${outstanding}`);
}
```

ğŸ‘‡

```javascript
function printOwing(invoice) {
    printBanner();
    let outstanding = calculateOutstanding();
    
    function printDetails(outstanding) {
        console.log(`name: ${invoice.customer}`);
        console.log(`amount: ${outstanding}`);
    }
}
```



### 6.2 å†…è”å‡½æ•°ï¼ˆInline Functionï¼‰[115]

```javascript
function getRating(driver) {
    return moreThanFiveLateDeliveries(driver) ? 2 : 1;
}

function moreThanFiveLateDeliveries(driver) {
    return driver.numberOfLateDeliveries > 5;
}
```

ğŸ‘‡

```javascript
function getRating(driver) {
    return (driver.numberOfLateDeliveries > 5) ? 2 : 1;
}
```



### 6.3 æç‚¼å˜é‡ï¼ˆExtract Variableï¼‰[119]

```javascript
return order.quantity * order.itemPrice -
    Math.max(0, order.quantity - 500) * order.itemPrice * 0.05 +
    Math.min(order.quantity * order.itemPrice * 0.01, 100);
```

ğŸ‘‡

```javascript
const basePrice = order.quantity * order.itemPrice;
const quantityDiscount = Math.max(0, order.quantity - 500) * order.itemPrice * 0.05;
const shipping = Math.min(order.quantity * order.itemPrice * 0.01, 100);
return basePrice - quantityDiscount + shipping;
```



### 6.4 å†…è”å˜é‡ï¼ˆInline Variableï¼‰[123]

```javascript
let basePrice = anOrder.basePrice;
return (basePrice > 1000);
```

ğŸ‘‡

```javascript
return anOrder.basePrice > 1000;
```



### 6.5 æ”¹å˜å‡½æ•°ç­¾åï¼ˆChange Function Declarationï¼‰[124]

> æŠŠâ€œå£°æ˜â€æ”¹ä¸ºäº†â€œç­¾åâ€

```javascript
function circum(radius) {... }
```

ğŸ‘‡

```javascript
function circumference(radius) {... }
```



### 6.6 å°è£…å˜é‡ï¼ˆEncapsulate Variableï¼‰[132]

```javascript
let defaultOwner = { firstName: "Martin", lastName: "Fowler" };
```

ğŸ‘‡

```javascript
let defaultOwnerData = { firstName: "Martin", lastName: "Fowler" };
export function defaultOwner() { return defaultOwnerData; }
export function setDefaultOwner(arg) { defaultOwnerData = arg; }
```



### 6.7 æç‚¼å‡½æ•°ï¼ˆRename Variableï¼‰[137]

```javascript
let a = height * width;
```

ğŸ‘‡

```javascript
let area = height * width;
```



### 6.8 å¼•å…¥å‚æ•°å¯¹è±¡ï¼ˆIntroduce Parameter Objectï¼‰[140]

```javascript
function amountInvoiced(startDate, endDate) {... }
function amountReceived(startDate, endDate) {... }
function amountOverdue(startDate, endDate) {... }
```

ğŸ‘‡

```javascript
function amountInvoiced(aDateRange ) {... }
function amountReceived(aDateRange ) {... }
function amountOverdue(aDateRange ) {... }
```



### 6.9 å‡½æ•°ç»„åˆæˆç±»ï¼ˆCombine Functions into Classï¼‰[144]

```javascript
function base(aReading) {... }
function taxableCharge(aReading) {... }
function calculateBaseCharge(aReading) {... }
```

ğŸ‘‡

```javascript
class Reading {
    base(aReading) {... }
    taxableCharge(aReading) {... }
    calculateBaseCharge(aReading) {... }
}
```



### 6.10 å‡½æ•°ç»„åˆæˆå˜æ¢ï¼ˆCombine Functions into Transformï¼‰[149]

```javascript
function base(aReading) {... }
function taxableCharge(aReading) {... }
```

ğŸ‘‡

```javascript
function enrichReading(argReading) {
    const aReading = _.cloneDeep(argReading);
    aReading.baseCharge = base(aReading);
    aReading.taxableCharge = taxableCharge(aReading);
    return aReading;
}
```



### 6.11 æ‹†åˆ†é˜¶æ®µï¼ˆSplit Phaseï¼‰[154]

```javascript
const orderData = orderString.split(/\s+/);
const productPrice = priceList[orderData[0].split("-")[1]];
const orderPrice = parseInt(orderData[1]) * productPrice;
```

ğŸ‘‡

```javascript
const orderRecord = parseOrder(order);
const orderPrice = price(orderRecord, priceList);

function parseOrder(aString) {
    const values = aString.split(/\s+/);
    return ({
        productID: values[0].split("-")[1],
        quantity: parseInt(values[1]),
    });
}
function price(order, priceList) {
    return order.quantity * priceList[order.productID];
}
```





